<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Game Catalog - GP</title>
  <link rel="icon" type="image/png" href="https://gpsite.github.io/gpmedia/img/logo.png">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">

  <!-- Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Fuse.js -->
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

  <!-- Ruffle (Flash Emulator) -->
  <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>

  <style>
    :root {
      /* Theme Config - Dark */
      --bg-dark: url("https://gpsite.github.io/gpmedia/img/g-page/gamedark.png");
      --bg-light: url("https://gpsite.github.io/gpmedia/img/g-page/gamelight.jpg");

      --glass: rgba(255, 255, 255, 0.08);
      --glass-strong: rgba(20, 20, 20, 0.6);
      --glass-border: rgba(255, 255, 255, 0.12);
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.6);
      --accent: #60a5fa;
      --accent-glow: rgba(96, 165, 250, 0.4);

      --pill-bg: rgba(255, 255, 255, 0.08);
      --pill-hover: rgba(255, 255, 255, 0.15);

      --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 20px 50px rgba(0, 0, 0, 0.3);

      --transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);

      /* Scalable Units */
      --font-main: clamp(0.9rem, 1.2vw, 1.05rem);
      --header-padding: clamp(15px, 2.5vw, 40px);
    }

    [data-theme="light"] {
      /* Light Theme Overrides */
      --glass: rgba(255, 255, 255, 0.75);
      --glass-strong: rgba(255, 255, 255, 0.9);
      --glass-border: rgba(0, 0, 0, 0.06);
      --text-primary: #1e293b;
      --text-secondary: #475569;
      --accent: #2563eb;
      --accent-glow: rgba(37, 99, 235, 0.2);
      --pill-bg: rgba(0, 0, 0, 0.04);
      --pill-hover: rgba(0, 0, 0, 0.08);
      --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.05);
      --shadow-lg: 0 20px 50px rgba(0, 0, 0, 0.15);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-font-smoothing: antialiased;
    }

    body {
      font-family: 'Outfit', sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background-color: #000;
      color: var(--text-primary);
      overflow-x: hidden;
    }

    /* Dynamic Background Layer */
    .bg-layer {
      position: fixed;
      inset: 0;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      z-index: -2;
      transition: background-image 0.8s ease;
      filter: saturate(40%);
    }

    [data-theme="dark"] .bg-layer {
      background-image: var(--bg-dark);
    }

    [data-theme="light"] .bg-layer {
      background-image: var(--bg-light);
      filter: brightness(1.02);
    }

    /* --- NAVIGATION --- */
    header {
      width: 100%;
      padding: var(--header-padding);
      padding-bottom: 20px;
      display: flex;
      justify-content: center;
      z-index: 100;
      position: relative;
    }

    /* Unified Navbar Pill */
    .nav-pill {
      display: flex;
      align-items: center;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 100px;
      padding: 6px;
      backdrop-filter: blur(16px);
      box-shadow: var(--shadow-lg);
      width: 100%;
      max-width: 900px;
      gap: 8px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 24px;
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 600;
      border-radius: 100px;
      transition: var(--transition);
      white-space: nowrap;
      cursor: pointer;
    }

    .nav-item:hover,
    .nav-item.active {
      background: var(--pill-hover);
    }

    .nav-item i {
      width: 18px;
      height: 18px;
    }

    .search-container {
      flex: 1;
      position: relative;
      display: flex;
      align-items: center;
      background: var(--pill-bg);
      border-radius: 100px;
      padding: 2px;
      transition: var(--transition);
    }

    .search-container:focus-within {
      background: var(--pill-hover);
      box-shadow: 0 0 0 2px var(--accent-glow);
    }

    .search-input {
      width: 100%;
      border: none;
      background: transparent;
      color: var(--text-primary);
      font-family: inherit;
      font-size: 1rem;
      padding: 10px 16px;
      outline: none;
    }

    .search-input::placeholder {
      color: var(--text-secondary);
    }

    /* --- CONTENT GRIDS --- */
    main {
      width: 100%;
      max-width: 1600px;
      margin: 0 auto;
      padding: 0 var(--header-padding) 60px;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 40px;
      z-index: 10;
    }

    /* Top Grid */
    .top-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 24px;
      width: 100%;
    }

    /* Featured Divider */
    .featured-divider {
      display: flex;
      align-items: center;
      gap: 20px;
      width: 100%;
      margin: 10px 0;
      opacity: 0.9;
    }

    .diamond {
      width: 8px;
      height: 8px;
      background: var(--accent);
      transform: rotate(45deg);
      box-shadow: 0 0 10px var(--accent);
    }

    .divider-line {
      flex: 1;
      height: 2px;
      background: linear-gradient(90deg, var(--accent) 0%, transparent 100%);
      border-radius: 1px;
    }

    .divider-text {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-primary);
      text-transform: uppercase;
      letter-spacing: 1px;
      white-space: nowrap;
    }

    /* Main Grid */
    .main-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 24px;
      /* More breathing room for text below */
      width: 100%;
      align-items: start;
    }

    /* Game Card Styling (Redesigned) */
    .game-card {
      display: flex;
      flex-direction: column;
      gap: 12px;
      cursor: pointer;
    }

    .card-image-wrapper {
      aspect-ratio: 1;
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid var(--glass-border);
      background: var(--glass);
      box-shadow: var(--shadow-sm);
      transition: var(--transition);
      position: relative;
    }

    .card-image-wrapper::after {
      content: '';
      position: absolute;
      inset: 0;
      background: rgba(255, 255, 255, 0.1);
      opacity: 0;
      transition: var(--transition);
    }

    .game-card:hover .card-image-wrapper {
      transform: translateY(-6px);
      box-shadow: var(--shadow-lg);
      border-color: var(--accent);
    }

    .game-card:hover .card-image-wrapper::after {
      opacity: 1;
    }

    .game-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .card-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .card-title {
      color: var(--text-primary);
      font-weight: 700;
      font-size: 1.05rem;
      line-height: 1.3;
    }

    .card-meta {
      color: var(--text-secondary);
      font-size: 0.85rem;
      font-weight: 500;
    }

    /* Loading State */
    .loader {
      grid-column: 1 / -1;
      text-align: center;
      padding: 40px;
      color: var(--text-secondary);
      font-size: 1.2rem;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 0.5;
      }

      50% {
        opacity: 1;
      }
    }

    /* GAME OVERLAY */
    .game-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.92);
      backdrop-filter: blur(14px);
      z-index: 9999;
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      padding: 20px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .game-overlay.active {
      opacity: 1;
    }

    .game-wrapper {
      width: 90vw;
      height: 80vh;
      background: #000;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      border: 1px solid var(--glass-border);
      position: relative;
    }

    .game-wrapper iframe,
    .game-wrapper object {
      width: 100%;
      height: 100%;
      border: none;
    }

    .overlay-controls {
      margin-top: 20px;
      display: flex;
      gap: 12px;
    }

    .control-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 10px 20px;
      border-radius: 50px;
      color: #fff;
      cursor: pointer;
      font-family: inherit;
      font-weight: 500;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .control-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .control-btn i {
      width: 16px;
      height: 16px;
    }

    /* Split Button Group */
    .control-group {
      display: flex;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 50px;
      overflow: hidden;
    }

    .control-group .control-btn {
      background: transparent;
      border: none;
      border-radius: 0;
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      margin: 0;
    }

    .control-group .control-btn:last-child {
      border-right: none;
    }

    .control-group .control-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .filter-modal {
      position: absolute;
      top: 100%;
      margin-top: -10px;
      background: var(--glass);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      padding: 16px;
      border-radius: 16px;
      display: none;
      flex-direction: column;
      gap: 8px;
      min-width: 200px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--glass-border);
      z-index: 200;

      /* Scrollbar */
      scrollbar-width: thin;
      scrollbar-color: var(--glass-border) transparent;
    }

    .filter-modal::-webkit-scrollbar {
      width: 6px;
    }

    .filter-modal::-webkit-scrollbar-thumb {
      background: var(--glass-border);
      border-radius: 4px;
    }

    .filter-modal.active {
      display: flex;
    }

    .filter-option {
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      color: var(--text-primary);
      transition: var(--transition);
    }

    .filter-option:hover {
      background: var(--pill-bg);
    }

    @media (max-width: 768px) {
      .nav-pill {
        flex-direction: column;
        gap: 12px;
        padding: 16px;
        border-radius: 24px;
        /* Keep the container glass style active */
        background: var(--glass);
        border: 1px solid var(--glass-border);
        backdrop-filter: blur(16px);
        box-shadow: var(--shadow-lg);
      }

      .nav-item {
        width: 100%;
        justify-content: center;
        /* Remove the individual item box styling we added previously */
        background: transparent;
        border: none;
        backdrop-filter: none;
        padding: 10px;
        border-radius: 12px;
      }

      .nav-item:hover {
        background: var(--pill-hover);
      }

      .search-container {
        width: 100%;
        /* Use standard pill internal bg */
        background: var(--pill-bg);
        border: none;
        padding: 4px;
      }

      /* Responsive Grid Sizing: Keep cards explicitly same size as desktop */
      .top-grid,
      .main-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 16px;
      }
    }

    /* --- UNIFIED LOADER STYLES --- */
    .video-loader {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #000;
      z-index: 10;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .loader-text {
      color: #fff;
      font-size: 14px;
      letter-spacing: 1px;
      text-transform: uppercase;
      opacity: 0.8;
      font-weight: 500;
      font-family: 'Outfit', sans-serif;
    }
  </style>
</head>

<body>
  <div class="bg-layer"></div>

  <header>
    <div class="nav-pill">
      <a href="../../index.html" class="nav-item">
        <i data-lucide="home"></i> Home
      </a>

      <div class="nav-item" id="filterBtn">
        <i data-lucide="filter"></i> Filters
      </div>

      <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="Search games...">
      </div>
    </div>

    <!-- Simple Filter Dropdown (Placeholder for logic) -->
    <div class="filter-modal" id="filterMenu">
      <div class="filter-option" onclick="filterBy('All')">All Categories</div>
    </div>
  </header>

  <main>
    <!-- Top Featured Grid (Marked with *) -->
    <div class="top-grid" id="topGrid">
      <div class="loader">Loading Library...</div>
    </div>

    <!-- Divider -->
    <div class="featured-divider">
      <div class="diamond"></div>
      <span class="divider-text">All Games</span>
      <div class="divider-line"></div>
    </div>

    <!-- Main Catalog Grid -->
    <div class="main-grid" id="mainGrid">
      <!-- Injected via JS -->
    </div>
  </main>

  <!-- Game Overlay -->
  <div class="game-overlay" id="gameOverlay">
    <div class="game-wrapper" id="gameWrapper">
      <!-- Loader -->
      <div class="video-loader" id="videoLoader">
        <div class="spinner"></div>
        <div class="loader-text">George Pickens</div>
      </div>
      <!-- Content Container -->
      <div id="gameContainer" style="width:100%; height:100%;"></div>
    </div>
    <div class="overlay-controls">
      <div class="control-group">
        <button class="control-btn" onclick="toggleFullscreen()"><i data-lucide="maximize"></i> Fullscreen</button>
        <button class="control-btn" onclick="openWindowed()"><i data-lucide="external-link"></i> Windowed</button>
      </div>
      <button class="control-btn" onclick="closeOverlay()"><i data-lucide="x"></i> Close</button>
    </div>
  </div>

  <!-- Scripts -->
  <script>lucide.createIcons();</script>

  <script>
    // --- THEME ENGINE ---
    const html = document.documentElement;
    const currentTheme = localStorage.getItem('gp-final-theme') || 'dark';
    html.setAttribute('data-theme', currentTheme);

    window.addEventListener('storage', (e) => {
      if (e.key === 'gp-final-theme') {
        html.setAttribute('data-theme', e.newValue);
      }
    });

    // --- DATA & LOGIC ---
    const SHEET_URL = 'https://sheets.googleapis.com/v4/spreadsheets/1nw0SDop0IeFr6q776thp_eSCZZulaxZBtM55ECrHD5A/values/games?key=AIzaSyBdnupZe6bJH43XE0Hj77n0AmlR3wVfN9M';

    let allGames = [];
    let categories = new Set();
    let fuse;
    let currentGameUrl = null;

    const topGrid = document.getElementById('topGrid');
    const mainGrid = document.getElementById('mainGrid');
    const searchInput = document.getElementById('searchInput');
    const filterBtn = document.getElementById('filterBtn');
    const filterMenu = document.getElementById('filterMenu');
    const gameOverlay = document.getElementById('gameOverlay');
    const gameWrapper = document.getElementById('gameWrapper');
    const gameContainer = document.getElementById('gameContainer');
    const videoLoader = document.getElementById('videoLoader');

    async function fetchGames() {
      try {
        const res = await fetch(SHEET_URL);
        const data = await res.json();
        const rows = data.values;
        const headers = rows.shift(); // Remove header row

        const titleIdx = headers.indexOf('Title');
        const catIdx = headers.indexOf('Category');
        const urlIdx = headers.indexOf('URL');
        const thumbIdx = headers.indexOf('Thumbnail');

        allGames = rows.map(row => {
          let rawTitle = row[titleIdx] || '';
          let isFeatured = false;

          // Check for * prefix (handle optional space)
          if (rawTitle.trim().startsWith('*')) {
            isFeatured = true;
            rawTitle = rawTitle.trim().substring(1).trim();
          }

          const cats = row[catIdx] ? row[catIdx].split(',').map(c => c.trim()) : [];
          cats.forEach(c => categories.add(c));

          return {
            title: rawTitle,
            isFeatured: isFeatured,
            categories: cats,
            url: row[urlIdx] ? row[urlIdx].trim() : '',
            thumbnail: row[thumbIdx],
            titleNoSpace: rawTitle.toLowerCase().replace(/\s+/g, '')
          };
        }).filter(g => g.title && g.url);

        initFuse();
        populateFilters();
        renderAll(allGames);
        lucide.createIcons();

      } catch (err) {
        console.error('Failed to load games:', err);
        topGrid.innerHTML = '<div class="loader" style="color:var(--accent);">Failed to load games. Check connection.</div>';
      }
    }

    function initFuse() {
      fuse = new Fuse(allGames, {
        keys: [
          { name: 'title', weight: 0.7 },
          { name: 'titleNoSpace', weight: 0.5 },
          { name: 'categories', weight: 0.3 }
        ],
        threshold: 0.4,
        distance: 100,
        includeScore: true
      });
    }

    function populateFilters() {
      filterMenu.innerHTML = '<div class="filter-option" onclick="filterBy(\'All\')">All Categories</div>';
      const sortedCats = Array.from(categories).sort();
      sortedCats.forEach(cat => {
        const div = document.createElement('div');
        div.className = 'filter-option';
        div.textContent = cat;
        div.onclick = () => filterBy(cat);
        filterMenu.appendChild(div);
      });
    }

    function filterBy(cat) {
      filterMenu.classList.remove('active');
      if (cat === 'All') {
        renderAll(allGames);
      } else {
        const filtered = allGames.filter(g => g.categories.includes(cat));
        renderAll(filtered);
      }
    }

    // Toggle Filter Menu
    filterBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      filterMenu.classList.toggle('active');
    });

    // Close menu on click outside
    document.addEventListener('click', (e) => {
      if (!filterMenu.contains(e.target) && !filterBtn.contains(e.target)) {
        filterMenu.classList.remove('active');
      }
    });

    function createCard(game) {
      const card = document.createElement('div');
      card.className = 'game-card';
      card.innerHTML = `
                <div class="card-image-wrapper">
                    <img src="${game.thumbnail || 'https://via.placeholder.com/300?text=No+Image'}" alt="${game.title}" loading="lazy">
                </div>
                <div class="card-info">
                    <div class="card-title">${game.title}</div>
                    <div class="card-meta">${game.categories.slice(0, 2).join(', ')}</div>
                </div>
            `;
      card.onclick = () => openGame(game);
      return card;
    }

    function renderAll(games) {
      topGrid.innerHTML = '';
      mainGrid.innerHTML = '';

      if (games.length === 0) {
        topGrid.innerHTML = '<div class="loader">No games found.</div>';
        return;
      }

      const isFullList = games.length === allGames.length;

      if (isFullList) {
        // Default View: Featured (*) in Top Grid, Rest in Main
        const featured = games.filter(g => g.isFeatured);
        const rest = games.filter(g => !g.isFeatured);

        if (featured.length > 0) {
          featured.forEach(g => topGrid.appendChild(createCard(g)));
        } else {
          topGrid.style.display = 'none'; // Hide if none
          document.querySelector('.featured-divider').style.display = 'none';
        }

        rest.forEach(g => mainGrid.appendChild(createCard(g)));
      } else {
        // Search Results / Filter View: Hide Featured Section, dump all in Main for clarity
        topGrid.style.display = 'none';
        document.querySelector('.featured-divider').style.display = 'none';
        games.forEach(g => mainGrid.appendChild(createCard(g)));
      }

      // Re-show sections if we reset and there are featured games
      if (isFullList && topGrid.children.length > 0) {
        topGrid.style.display = 'grid';
        document.querySelector('.featured-divider').style.display = 'flex';
      }
    }

    // --- SEARCH ---
    let debounceTimer;
    searchInput.addEventListener('input', (e) => {
      const query = e.target.value.trim();
      clearTimeout(debounceTimer);

      debounceTimer = setTimeout(() => {
        if (!query) {
          renderAll(allGames);
          return;
        }

        if (fuse) {
          const results = fuse.search(query).map(r => r.item);
          renderAll(results);
        }
      }, 300);
    });

    // --- OVERLAY & PLAYER ---

    async function openGame(game) {
      currentGameUrl = game.url;
      // 1. Reset & Show Overlay with Loader
      gameContainer.innerHTML = '';
      videoLoader.style.display = 'flex';
      gameOverlay.style.display = 'flex';
      requestAnimationFrame(() => gameOverlay.classList.add('active'));

      // 2. Determine Type
      // Check for .swf (case insensitive, allowing query params)
      const isSwf = /\.swf($|\?)/i.test(game.url);

      if (isSwf) {
        await loadSwfGame(game.url);
      } else {
        await loadIframeGame(game.url);
      }
    }

    function loadSwfGame(url) {
      return new Promise((resolve) => {
        // Create Ruffle Player
        const ruffle = window.RufflePlayer.newest();
        const player = ruffle.createPlayer();

        player.style.width = '100%';
        player.style.height = '100%';
        player.id = 'gameObject'; // for fullscreen

        // Hide initially
        player.style.opacity = '0';
        player.style.transition = 'opacity 0.5s ease';

        gameContainer.appendChild(player);

        // Load
        player.load(url).then(() => {
          console.log("Ruffle loaded SWF");
          // 2-second delay for branding/smoothness
          setTimeout(() => {
            videoLoader.style.display = 'none';
            player.style.opacity = '1';
            resolve();
          }, 2000);
        }).catch(e => {
          console.error("Ruffle failed to load:", e);
          videoLoader.innerHTML = '<div style="color:red">Failed to load content.</div>';
        });
      });
    }

    function loadIframeGame(url) {
      return new Promise((resolve) => {
        const iframe = document.createElement('iframe');
        iframe.src = url;
        iframe.allow = "autoplay; fullscreen";
        iframe.id = "gameIframe";
        iframe.style.width = '100%';
        iframe.style.height = '100%';
        iframe.style.border = 'none';
        iframe.style.opacity = '0';
        iframe.style.transition = 'opacity 0.5s ease';

        iframe.onload = () => {
          setTimeout(() => {
            videoLoader.style.display = 'none';
            iframe.style.opacity = '1';
            resolve();
          }, 2000); // 2 second delay
        };

        gameContainer.appendChild(iframe);
      });
    }

    function closeOverlay() {
      gameOverlay.classList.remove('active');
      setTimeout(() => {
        gameOverlay.style.display = 'none';
        gameContainer.innerHTML = '';
        videoLoader.style.display = 'none'; // reset
      }, 300);
    }

    function toggleFullscreen() {
      const el = document.querySelector("#gameIframe") || document.querySelector("#gameObject");
      if (!el) return;
      if (!document.fullscreenElement) {
        el.requestFullscreen().catch(err => console.error(err));
      } else {
        document.exitFullscreen();
      }
    }

    function openWindowed() {
      if (!currentGameUrl) return;

      const win = window.open('about:blank', '_blank');
      if (!win) return;

      // Check for .swf (case insensitive, allowing query params)
      const isSwf = /\.swf($|\?)/i.test(currentGameUrl);

      if (isSwf) {
        // Embed Ruffle in new window
        win.document.write(`
          <!DOCTYPE html>
          <html style="margin:0; padding:0; height:100%; overflow:hidden; background:#000;">
          <head>
            <title>GEORGE PICKENS</title>
            <script src="https://unpkg.com/@ruffle-rs/ruffle"><\/script>
            <style>
              body { margin:0; padding:0; height:100vh; width:100vw; background:#000; display:flex; justify-content:center; align-items:center; overflow:hidden; }
              #player { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
              ruffle-player { width: 100vh !important; height: 100vh !important; } 
            </style>
          </head>
          <body>
            <div id="player"></div>
            <script>
              window.RufflePlayer = window.RufflePlayer || {};
              window.addEventListener('DOMContentLoaded', () => {
                  const ruffle = window.RufflePlayer.newest();
                  const player = ruffle.createPlayer();
                  const container = document.getElementById('player');
                  container.appendChild(player);
                  player.load("${currentGameUrl}");
              });
            <\/script>
          </body>
          </html>
        `);
        win.document.close();
      } else {
        // Generic Iframe
        win.document.write(`
          <!DOCTYPE html>
          <html style="margin:0; padding:0; height:100%; overflow:hidden; background:#000;">
          <head><title>Game Selection</title></head>
          <body>
            <iframe src="${currentGameUrl}" style="border:0; width:100vw; height:100vh;" allow="autoplay; fullscreen"></iframe>
          </body>
          </html>
        `);
      }
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && gameOverlay.classList.contains('active')) {
        closeOverlay();
      }
    });

    fetchGames();

  </script>
</body>

</html>
